---
title: "Homework5"
author: "Eric Song"
format: html
editor: visual
---

```{r,include=FALSE}
library(tidyverse)
library(dplyr)
```

## Task 1

**Original Code**

```{r}
d1=read.table("student-mat.csv",sep=";",header=TRUE)
d2=read.table("student-por.csv",sep=";",header=TRUE)
d3=merge(d1,d2,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))
str(d3)
print(nrow(d3)) # 382 students
```

Looks like a bunch of variables got split into x & y.  Looking at the data, only G1,G2,G3, absences, and paid seem to be different than their pairs.

**Using inner join().**   

```{r}
joined_d3 <- inner_join(d1,d2, 
                        by = c("school", "sex", "age", "address", "famsize","Pstatus","Medu", "Fedu", "Mjob", "Fjob", "reason","nursery","internet")
)

str(joined_d3)
```

Many to many relationship warning on row 79.  Our data is also split between non joined variables.      

**All variables but no G1,G2,G3,Paid, and absences.**

```{r}
final_d1 <- inner_join(d1, d2,
              #joins everything but specified columns in setdiff
              by = names(d1) |>
                setdiff(c("G1", "G2", "G3", "paid", "absences"))
)
str(final_d1)
```

Now only variables that are split are the ones we specified.  

**Picking School,Sex, Famsize, and Reason as our categorical variables.**
```{r}
final_d1 <- final_d1 %>%
  mutate(
    school = as.factor(school),
    sex = as.factor(sex),
    famsize = as.factor(famsize),
    reason = as.factor(reason)
  )
str(final_d1)
```

Now as factors.

## Task 2

#### Categorical Variables

**One-way contingency table**
```{r}
one_way_tbl <- table(final_d1$school)
one_way_tbl
one_way_tbl[1]
```

There are 287 students going to GP.

**Two-way contingency table**
```{r}
two_way_tbl <- table(final_d1$school,final_d1$sex)
two_way_tbl
two_way_tbl[1,1]
```

153 Female students go to GP.  

**Three-way contingency table**
```{r}
three_way_tbl <- table(final_d1$school,final_d1$sex,final_d1$famsize)
three_way_tbl
three_way_tbl[1,1,1]
```

115 Female Students that go to GP come from a family greater than 3.  


**Filter method:**
```{r}
filter_d1 <- final_d1 |> 
  filter(school == "GP")
cond_two_way <-table(filter_d1$sex,filter_d1$famsize)
cond_two_way
```

**Three way table method (using previous three way variable):**
```{r}
cond_three_way <- three_way_tbl["GP",,]
cond_three_way
```

**Using group_by(),summarize(),and pivot_wider().**

```{r}
new_two_way <- final_d1 |>
                  group_by(school,sex) |>
                  summarize(count=n()) |>
                  pivot_wider(names_from=sex,values_from=count)
new_two_way
```

**Stacked bar graph**
```{r}
ggplot(data= final_d1 , aes(x = reason, fill = sex)) +
  geom_bar() + 
  labs(
    title = "Stacked Bar Graph: Reason vs Sex",
    x = "School",
    y = "# of Students",
    fill = "Sex"
  )
```

Seems fairly even.  Reputation might be more for females.

**Side by Side Graph.**
```{r}
ggplot(data= final_d1 ,aes(x = school, fill = sex)) +
  geom_bar(position = "dodge") + 
  labs(
    title = "Side by Side Graph: School vs Sex",
    x = "School",
    y = "# of Students",
    fill = "Sex"
  )
```

#### Numeric Variables


**Single Grouping (by sex):**
```{r}
one_summary <- final_d1 |>
                group_by(sex) |>
                  summarise(
                    #G3
                    mean_G3 = mean((G3.x+G3.y)/2, na.rm = TRUE),
                    median_G3 = median((G3.x+G3.y)/2, na.rm = TRUE),
                    sd_G3 = sd((G3.x+G3.y)/2, na.rm = TRUE),
                    IQR_G3 = IQR((G3.x+G3.y)/2, na.rm = TRUE),
                    #Age
                    mean_age = mean(age, na.rm = TRUE),
                    median_age = median(age, na.rm = TRUE),
                    sd_age = sd(age, na.rm = TRUE),
                    IQR_age = IQR(age, na.rm = TRUE),
                    #health
                    mean_health = mean(health, na.rm = TRUE),
                    median_health = median(health, na.rm = TRUE),
                    sd_health = sd(health, na.rm = TRUE),
                    IQR_health = IQR(health, na.rm = TRUE)
                   )
one_summary
```
Summary of G3,age,and health.




**Two grouping variables (Sex and School):**
```{r}
two_summary <- final_d1 |>
                group_by(sex,school) |>
                  summarise(
                    #G2
                    mean_G2 = mean((G2.x+G2.y)/2, na.rm = TRUE),
                    median_G2 = median((G2.x+G2.y)/2, na.rm = TRUE),
                    sd_G2 = sd((G2.x+G2.y)/2, na.rm = TRUE),
                    IQR_G2 = IQR((G2.x+G2.y)/2, na.rm = TRUE),
                    #age
                    mean_age = mean(age, na.rm = TRUE),
                    median_age = median(age, na.rm = TRUE),
                    sd_age = sd(age, na.rm = TRUE),
                    IQR_age = IQR(age, na.rm = TRUE),
                    #absences
                    mean_absences = mean((absences.x+absences.y)/2, na.rm = TRUE),
                    median_absences = median((absences.x+absences.y)/2, na.rm = TRUE),
                    sd_absences = sd((absences.x+absences.y)/2, na.rm = TRUE),
                    IQR_absences = IQR((absences.x+absences.y)/2, na.rm = TRUE)
                   )
two_summary
```
Split between gender and school.
**Correlation matrix of all numeric variables.**

```{r}
numeric_d1 <- final_d1 |>
  select(where(is.numeric))
num_cor_matrix <- cor(numeric_d1)
num_cor_matrix
```


**Histogram of Age & Sex**

```{r}
ggplot(data= final_d1 , aes(x = age, fill = sex)) +
  geom_histogram(binwidth = 1) +
  labs(
    title = "Histogram of Age by Sex",
    x = "Age",
    y = "Count",
    fill = "Sex"
  )
```

Few outliers noted, older students.


**Kernel Density Plot**

#fix

```{r}
ggplot(data= final_d1 , aes(x = (G1.x+G1.y)/2,color =sex)) +
  geom_density() +
  labs(
    title = "Kernel Density Plot of Mean of G1",
    x = "Mean of G1 values",
    y = "Density",
    color="Sex"
  )
```

Somewhat skewed.

**Boxplot of two numerical variables w/ categorical**

```{r}
ggplot(data= final_d1 , aes(x = (G2.x+G2.y)/2, fill=sex)) +
  geom_boxplot() +
  labs(
    title = "Boxplot of G2 scores by Sex",
    x = "Mean of G2",
    fill="Sex"
)
```

Males scored slightly higher.  




**Scatterplot #1**

```{r}
ggplot(final_d1,  aes(x = age, y = (G3.x+G3.y)/2, color = sex) ) +
  geom_point(position = "jitter") + 
  labs(
    title = "Scatterplot of G3 vs. Age with Sex",
    x = "Age",
    y = "Mean of G3",
    color = "Sex"
  )
```

Looks fairly random.

**Scatterplot #2**

```{r}
ggplot(final_d1,  aes(x = Medu, y = (G3.x+G3.y)/2, color = reason) ) +
  geom_point(position = "jitter") + 
  labs(
    title = "Scatterplot of G3 vs. Male Education classified by Reason",
    x = "Male Education",
    y = "Mean of G3",
    color = "Sex"
  )
```



**Faceted Scatterplot #1**

```{r}
ggplot(final_d1, aes(x = age, y = (G3.x+G3.y)/2, color = sex)) +
  geom_point(position="jitter") +
  labs(
    title = "Scatterplot of G3 vs. Age with Sex, Faceted by School",
    x = "Age",
    y = "G3",
    color = "Sex"
    ) +
    facet_wrap(~ school)
```

Looks like more variance at school MS.

**Faceted Scatterplot #2**

```{r}
ggplot(final_d1, aes(x = Medu, y = (G3.x+G3.y)/2, color = sex)) +
  geom_point(position="jitter") +
  labs(
    title = "Scatterplot of G3.x vs. Male Education with Sex, Faceted by Reason",
    x = "Male Education Level",
    y = "G3",
    color = "Sex"
    ) +
    facet_wrap(~ reason)
```

Students favor reputation and course.


**Faceting Two Categorical Variables**
```{r}
ggplot(final_d1, aes(x = age, y = (G3.x+G3.y)/2, color = sex)) +
  geom_point(position="jitter") +
  labs(
    title = "Scatterplot of G3 vs. Age with Sex, Faceted by School and Sex",
    x = "Age",
    y = "G3",
    color = "Sex"
    ) +
    facet_grid(~ school ~ sex)
```

Less males at MS.